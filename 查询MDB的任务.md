\# 下面修改人群id，去掉外面的括号



\#【↓】这个是AIPL常用的28个人群

\# SEGMENT_ID="'SG11325','SG11324','SG11299','SG11298','SG11297','SG11296','SG11295','SG11294','SG11293','SG11292','SG11290','SG11289','SG11288','SG11287','SG11286','SG11285','SG11284','SG11283','SG11282','SG11281','SG11280','SG11279','SG11278','SG11277','SG11276','SG11275','SG11274','SG11273'"



\####################################

\#【↓】其他人群往这里面放，避免混淆

\#下面这个是乌龟11月2号要查的10月28号Ponds活动2人群的

\# SEGMENT_ID="'SG11485', 'SG11484', 'SG11483', 'SG11482', 'SG11481', 'SG11480', 'SG11479', 'SG11478', 'SG11477', 'SG11476', 'SG11475', 'SG11474', 'SG11473', 'SG11472', 'SG11471', 'SG11470', 'SG11469', 'SG11468', 'SG11467', 'SG11466', 'SG11465', 'SG11464', 'SG11463', 'SG11462', 'SG11461', 'SG11460', 'SG11459', 'SG11458', 'SG11457', 'SG11456', 'SG11455', 'SG11454', 'SG11453', 'SG11452', 'SG11451', 'SG11450', 'SG11449', 'SG11448', 'SG11447', 'SG11446', 'SG11445', 'SG11444', 'SG11443', 'SG11442', 'SG11441', 'SG11440', 'SG11439', 'SG11438', 'SG11437', 'SG11436', 'SG11435', 'SG11434', 'SG11433', 'SG11432', 'SG11420', 'SG11419', 'SG11416', 'SG11415', 'SG11414', 'SG11413', 'SG11412', 'SG11411', 'SG11410', 'SG11409', 'SG11408', 'SG11407', 'SG11383', 'SG11382', 'SG11381', 'SG11380', 'SG11379', 'SG11378', 'SG11299', 'SG11298', 'SG11297', 'SG11296', 'SG11295', 'SG11294', 'SG11293', 'SG11292'"



\# 全域AIPL人群（132个）

\# SEGMENT_ID="'SG11485','SG11484','SG11483','SG11482','SG11481','SG11480','SG11479','SG11478','SG11477','SG11476','SG11475','SG11474','SG11473','SG11472','SG11471','SG11470','SG11469','SG11468','SG11467','SG11466','SG11465','SG11464','SG11463','SG11462','SG11461','SG11460','SG11459','SG11458','SG11457','SG11456','SG11455','SG11454','SG11453','SG11452','SG11451','SG11450','SG11449','SG11448','SG11447','SG11446','SG11445','SG11444','SG11443','SG11442','SG11441','SG11440','SG11439','SG11438','SG11437','SG11436','SG11435','SG11434','SG11433','SG11432','SG11420','SG11419','SG11416','SG11415','SG11414','SG11413','SG11412','SG11411','SG11410','SG11409','SG11408','SG11407','SG11383','SG11382','SG11381','SG11380','SG11379','SG11378','SG11377','SG11376','SG11375','SG11374','SG11373','SG11372','SG11371','SG11370','SG11369','SG11368','SG11367','SG11366','SG11365','SG11364','SG11363','SG11362','SG11361','SG11360','SG11359','SG11358','SG11357','SG11356','SG11355','SG11354','SG11353','SG11352','SG11351','SG11350','SG11349','SG11348','SG11347','SG11346','SG11299','SG11298','SG11297','SG11296','SG11295','SG11294','SG11293','SG11292','SG11325','SG11324','SG11290','SG11289','SG11288','SG11287','SG11286','SG11285','SG11284','SG11283','SG11282','SG11281','SG11280','SG11279','SG11278','SG11277','SG11276','SG11275','SG11274','SG11273'"



\# SEGMENT_ID="'SG11411','SG11412','SG11413','SG11414','SG11415','SG11416'"



SEGMENT_ID="'SG11273','SG11274','SG11275','SG11276','SG11281','SG11283','SG11285','SG11287','SG11289','SG11324','SG11292','SG11293','SG11294','SG11295','SG11378','SG11379','SG11380'"



\# 乌龟于1105 19:55检查 全域AIPL人群（132个）

\# SEGMENT_ID="'SG11485','SG11484','SG11483','SG11482','SG11481','SG11480','SG11479','SG11478','SG11477','SG11476','SG11475','SG11474','SG11473','SG11472','SG11471','SG11470','SG11469','SG11468','SG11467','SG11466','SG11465','SG11464','SG11463','SG11462','SG11461','SG11460','SG11459','SG11458','SG11457','SG11456','SG11455','SG11454','SG11453','SG11452','SG11451','SG11450','SG11449','SG11448','SG11447','SG11446','SG11445','SG11444','SG11443','SG11442','SG11441','SG11440','SG11439','SG11438','SG11437','SG11436','SG11435','SG11434','SG11433','SG11432','SG11420','SG11419','SG11416','SG11415','SG11414','SG11413','SG11412','SG11411','SG11410','SG11409','SG11408','SG11407','SG11383','SG11382','SG11381','SG11380','SG11379','SG11378','SG11377','SG11376','SG11375','SG11374','SG11373','SG11372','SG11371','SG11370','SG11369','SG11368','SG11367','SG11366','SG11365','SG11364','SG11363','SG11362','SG11361','SG11360','SG11359','SG11358','SG11357','SG11356','SG11355','SG11354','SG11353','SG11352','SG11351','SG11350','SG11349','SG11348','SG11347','SG11346','SG11299','SG11298','SG11297','SG11296','SG11295','SG11294','SG11293','SG11292','SG11325','SG11324','SG11290','SG11289','SG11288','SG11287','SG11286','SG11285','SG11284','SG11283','SG11282','SG11281','SG11280','SG11279','SG11278','SG11277','SG11276','SG11275','SG11274','SG11273'"



\####################################

```shell
echo "本次查询人群包的更新周期时间大于等于：${SEGMENT_TASK_DATE}"
sql="
use audience_data_service;
  select
  s_t.segment_id '人群id',
  s_tk.cycle_datetime '人群更新的周期',
  s_tk.start_datetime '人群更新开始时间',
  s_tk.end_datetime '人群更新结束时间',
  timediff(s_tk.end_datetime,s_tk.start_datetime) as '人群更新耗时',
  case
 	when s_tk.status = 300 then '成功'
	when s_tk.status = 200 then '执行中'
	when s_tk.status = 301 then '失败'
	else s_tk.status
  end as '人群更新状态',
  seg_download.segment_name '人群包名称',
  seg_download.segment_latest_update_datetime '人群包依赖的人群更新时间',
  date_add(seg_download.create_datetime, interval '08:00:00' hour_second) as '人群包更新开始时间',
  date_add(seg_download.upd_datetime, interval '08:00:00' hour_second) as '人群包更新结束时间',
  seg_download.download_running_time '人群包更新耗时',
  dr.datafile_lines '人群包记录数',
  seg_download.status '人群包状态'
from
  segment_task s_t
  left join segment_task_tracking s_tk
  on s_tk.task_id = s_t.task_id
  left join 
(
	select
	sdt.segment_id,
	sdt.segment_name,
	sdtt.segment_latest_update_datetime,
	case 
		when sdtt.status = 1000 then '准备中'
		when sdtt.status = 2000 then '人群下载计算中'
		when sdtt.status = 3000 then '人群下载计算成功'
		when sdtt.status = 3001 then '人群下载计算失败'
		when sdtt.status = 4000 then '分发成功'
		when sdtt.status = 4001 then '分发失败'
	else '未知' end as status,
	sdtt.create_datetime,
	sdtt.upd_datetime,
	timediff(sdtt.upd_datetime,sdtt.create_datetime) as download_running_time,
	sdt.template
	from 
	segment_download_task sdt 
	inner join 
	 (
		select
		task_id,
		upd_datetime,
		create_datetime,
		segment_latest_update_datetime,
		status,
		workflow_exec_id
		from 
		segment_download_task_tracking
		group by 
		task_id,
		upd_datetime,
		create_datetime,
		segment_latest_update_datetime,
		status,
		workflow_exec_id
	 ) sdtt 
	on sdt.task_id = sdtt.task_id
	where sdt.segment_id in (${SEGMENT_ID})
) seg_download 
on s_t.segment_id = seg_download.segment_id
and s_tk.end_datetime = seg_download.segment_latest_update_datetime
left join segment_download_report dr 
on s_t.segment_id = dr.segment_id
and seg_download.template = dr.template
and substr(s_tk.start_datetime,1,10)= substr(dr.report_create_datetime,1,10)
where
  s_t.segment_id in (${SEGMENT_ID})
  and s_tk.start_datetime >='${SEGMENT_TASK_DATE}'
  and dr.report_create_datetime >= s_tk.end_datetime
  order by s_t.segment_id,s_tk.end_datetime asc;
"

echo "【SQL】= ${sql}"



echo "☆☆☆☆☆☆☆☆☆☆【START】☆☆☆☆☆☆☆☆☆☆"

mysql -h mdb-dp-prod.cvzriylmwija.rds.cn-north-1.amazonaws.com.cn -u jumpingqu -p"Yzpe8d3W9Yxg#" -e "${sql}"

echo "☆☆☆☆☆☆☆☆☆☆【END】☆☆☆☆☆☆☆☆☆☆"  

```